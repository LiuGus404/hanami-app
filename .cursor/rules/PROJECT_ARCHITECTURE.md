# Hanami Web 專案架構文檔

## 專案概述

Hanami Web 是一個支援手機和電腦的教育機構管理系統，使用 Next.js 14 和 Supabase 建立。系統支援三種用戶角色：合作老師、管理員和家長，每種角色都有專屬的登入入口和功能介面。

## 技術棧

- **前端框架**: Next.js 14 (App Router)
- **資料庫**: Supabase (PostgreSQL)
- **UI 框架**: Tailwind CSS
- **狀態管理**: React Context + Hooks
- **表單處理**: React Hook Form
- **型別檢查**: TypeScript
- **認證**: Supabase Auth

## 響應式設計

### 手機支援 (直向)
- 最大寬度：384px (max-w-sm)
- 單欄佈局
- 觸控友好的按鈕和介面
- 簡化的導航結構

### 電腦支援 (橫向)
- 最大寬度：1280px (max-w-7xl)
- 多欄佈局
- 完整的導航和功能
- 桌面優化的使用者體驗

## 用戶角色分流系統

### 1. 合作老師 (Teacher)
**登入入口**: `/teacher/login`
**儀表板**: `/teacher/dashboard`

#### 功能模組：
- **概覽**: 統計卡片、最近課程記錄
- **我的學生**: 學生列表、學生詳情、課程記錄
- **課程記錄**: 課程活動記錄、進度筆記
- **工作時間**: 工作時間表、排班管理
- **工作任務**: 任務分配、狀態追蹤

#### 權限範圍：
- 只能查看和管理自己負責的學生
- 可以記錄和修改學生的學習情況
- 可以查看自己的工作時間和任務

### 2. 家長 (Parent)
**登入入口**: `/parent/login`
**儀表板**: `/parent/dashboard`

#### 功能模組：
- **概覽**: 孩子學習概覽、統計資訊
- **學習進度**: 學習進度追蹤、發展情況
- **課堂影片**: 課程影片觀看
- **證書**: 學習證書查看
- **評語**: 老師評語和建議
- **時間表**: 上課時間表
- **課程包**: 課程包管理、續費
- **優惠券**: 優惠券使用

#### 權限範圍：
- 只能查看自己孩子的資料
- 可以查看孩子的學習進度和課程記錄
- 可以管理課程包和優惠券

### 3. 管理員 (Admin)
**登入入口**: `/admin/login`
**儀表板**: `/admin/dashboard`

#### 功能模組：
- 學生管理
- 教師管理
- 課程管理
- 系統設定
- 資料分析
- AI 工具
- 試讀學生管理

#### 權限範圍：
- 可以查看和管理所有資料
- 系統級別的管理權限

## 目錄結構

```
hanami-web/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── (auth)/            # 認證相關頁面
│   │   ├── admin/             # 管理員頁面
│   │   │   ├── login/         # 管理員登入
│   │   │   ├── dashboard/     # 管理員儀表板
│   │   │   └── ...            # 其他管理功能
│   │   ├── teacher/           # 老師頁面
│   │   │   ├── login/         # 老師登入
│   │   │   └── dashboard/     # 老師儀表板
│   │   ├── parent/            # 家長頁面
│   │   │   ├── login/         # 家長登入
│   │   │   └── dashboard/     # 家長儀表板
│   │   ├── layout.tsx         # 根佈局
│   │   └── page.tsx           # 首頁
│   ├── components/            # 可重用元件
│   │   ├── ui/               # 基礎 UI 元件
│   │   ├── ResponsiveLayout.tsx    # 響應式佈局
│   │   ├── UserRoleRedirect.tsx    # 用戶角色分流
│   │   └── ...               # 其他元件
│   ├── lib/                  # 工具函數和配置
│   │   ├── authUtils.ts      # 認證工具
│   │   ├── database.types.ts # 資料庫型別
│   │   └── ...               # 其他工具
│   └── utils/                # 工具函數
│       ├── supabaseSchemaScanner.ts # 資料庫掃描器
│       └── ...               # 其他工具
├── middleware.ts             # 路由中間件
└── ...                      # 其他配置檔案
```

## 認證和授權

### 用戶身份識別
系統通過以下方式識別用戶角色：

1. **管理員**: 檢查 `hanami_admin` 表格中的 `admin_email`
2. **老師**: 檢查 `hanami_employee` 表格中的 `teacher_email`
3. **家長**: 檢查 `Hanami_Students` 表格中的 `parent_email`

### 路由保護
- 使用 Next.js 中間件進行路由保護
- 未登入用戶自動重定向到對應的登入頁面
- 已登入用戶訪問首頁時自動分流到對應的儀表板

### 權限控制
- 使用 RLS (Row Level Security) 進行資料庫層級的權限控制
- 前端使用 RoleGuard 組件進行頁面級別的權限控制

## 響應式元件

### ResponsiveLayout
提供基礎的響應式佈局支援，自動適應手機和電腦顯示。

### ResponsiveGrid
響應式網格佈局，自動調整欄數：
- 手機：1 欄
- 平板：2 欄
- 桌面：3-4 欄

### ResponsiveCard
響應式卡片元件，自動調整內邊距和陰影。

### ResponsiveNav
響應式導航欄，支援水平滾動。

## 資料庫結構

### 核心表格
- `hanami_admin`: 管理員資料
- `hanami_employee`: 教師資料
- `Hanami_Students`: 學生資料
- `hanami_student_lesson`: 課程記錄
- `Hanami_Student_Package`: 課程包
- `hanami_teacher_schedule`: 教師工作時間表

### 關聯關係
- 老師與學生：一對多關係
- 學生與課程記錄：一對多關係
- 學生與課程包：一對多關係
- 家長與學生：通過 `parent_email` 關聯

## 開發指南

### 新增功能
1. 確認用戶角色和權限需求
2. 設計響應式 UI 佈局
3. 實現前端功能
4. 更新資料庫結構（如需要）
5. 添加權限控制
6. 測試手機和電腦顯示

### 響應式設計原則
1. 手機優先設計
2. 使用 Tailwind CSS 的響應式類別
3. 測試不同螢幕尺寸
4. 確保觸控友好

### 權限控制原則
1. 最小權限原則
2. 資料庫層級和應用層級雙重保護
3. 清晰的錯誤訊息
4. 安全的預設值

## 部署和維護

### 環境配置
- 開發環境：本地開發
- 測試環境：Vercel Preview
- 生產環境：Vercel Production

### 監控和日誌
- 使用 Supabase 的內建監控
- 前端錯誤追蹤
- 用戶行為分析

### 備份和恢復
- 定期資料庫備份
- 版本控制管理
- 災難恢復計劃

## 未來擴展

### 功能擴展
- 即時通訊功能
- 線上課程系統
- 支付整合
- 多語言支援

### 技術擴展
- PWA 支援
- 離線功能
- 推播通知
- 效能優化

---

最後更新：2024-03-21
版本：1.0.0 